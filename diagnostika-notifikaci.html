<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¬ Diagnostika NotifikaÄnÃ­ho SystÃ©mu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0b0f1a 0%, #1a1f2e 100%);
            color: #00ff99;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00d9ff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #00d9ff;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #00ff99;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            color: #00d9ff;
            margin-bottom: 15px;
            border-bottom: 2px solid #00d9ff;
            padding-bottom: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        .status-label {
            color: #00ff99;
            font-weight: bold;
        }
        
        .status-value {
            color: #ffffff;
        }
        
        .status-value.success {
            color: #00ff00;
        }
        
        .status-value.warning {
            color: #ff9900;
        }
        
        .status-value.error {
            color: #ff0000;
        }
        
        .btn {
            background: #00d9ff;
            color: #0b0f1a;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 217, 255, 0.4);
        }
        
        .btn:hover {
            background: #00ff99;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 255, 153, 0.5);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.danger {
            background: #ff5555;
            color: white;
        }
        
        .btn.danger:hover {
            background: #ff0000;
        }
        
        .console-output {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #00ff00;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .badge.active {
            background: #00ff00;
            color: #000;
        }
        
        .badge.inactive {
            background: #666;
            color: #fff;
        }
        
        .back-link {
            display: inline-block;
            color: #00d9ff;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
        
        .back-link:hover {
            color: #00ff99;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">ğŸ–– â† ZpÄ›t na LÃ©kaÅ™skÃ½ Protokol</a>
        
        <h1>ğŸ”¬ Diagnostika NotifikaÄnÃ­ho SystÃ©mu</h1>
        
        <!-- ZÃKLADNÃ INFORMACE -->
        <div class="section">
            <h2>ğŸ“Š ZÃ¡kladnÃ­ Informace</h2>
            <div class="status-item">
                <span class="status-label">ProhlÃ­Å¾eÄ:</span>
                <span class="status-value" id="browser-info">NaÄÃ­tÃ¡m...</span>
            </div>
            <div class="status-item">
                <span class="status-label">PWA Instalace:</span>
                <span class="status-value" id="pwa-status">NaÄÃ­tÃ¡m...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Notifikace povoleny:</span>
                <span class="status-value" id="notification-permission">NaÄÃ­tÃ¡m...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Service Worker:</span>
                <span class="status-value" id="sw-status">NaÄÃ­tÃ¡m...</span>
            </div>
        </div>
        
        <!-- PERIODIC SYNC STATUS -->
        <div class="section">
            <h2>ğŸ”„ Periodic Background Sync</h2>
            <div class="status-item">
                <span class="status-label">Podpora:</span>
                <span class="status-value" id="periodic-sync-support">NaÄÃ­tÃ¡m...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Registrace:</span>
                <span class="status-value" id="periodic-sync-registered">NaÄÃ­tÃ¡m...</span>
            </div>
            <div class="status-item">
                <span class="status-label">AktivnÃ­ syncs:</span>
                <span class="status-value" id="active-syncs">NaÄÃ­tÃ¡m...</span>
            </div>
        </div>
        
        <!-- FIREBASE STATUS -->
        <div class="section">
            <h2>ğŸ”¥ Firebase Cloud Messaging</h2>
            <div class="status-item">
                <span class="status-label">Firebase SDK:</span>
                <span class="status-value" id="firebase-status">NaÄÃ­tÃ¡m...</span>
            </div>
            <div class="status-item">
                <span class="status-label">FCM Token:</span>
                <span class="status-value" id="fcm-token">NaÄÃ­tÃ¡m...</span>
            </div>
        </div>
        
        <!-- OVLÃDÃNÃ -->
        <div class="section">
            <h2>ğŸ® OvlÃ¡dÃ¡nÃ­</h2>
            <div class="button-grid">
                <button class="btn" onclick="runFullDiagnostics()">ğŸ” PlnÃ¡ Diagnostika</button>
                <button class="btn" onclick="testNotification()">ğŸ“¤ Test Notifikace</button>
                <button class="btn" onclick="registerSync()">âœ… Aktivovat Periodic Sync</button>
                <button class="btn danger" onclick="unregisterSync()">âŒ Deaktivovat Sync</button>
                <button class="btn" onclick="syncMedicines()">ğŸ”„ Sync Data LÃ©kÅ¯</button>
                <button class="btn" onclick="clearConsole()">ğŸ§¹ VyÄistit Konzoli</button>
            </div>
        </div>
        
        <!-- KONZOLE OUTPUT -->
        <div class="section">
            <h2>ğŸ“ VÃ½stup Diagnostiky</h2>
            <div class="console-output" id="console-output">
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ DIAGNOSTICKÃ PANEL PÅ˜IPRAVEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Klikni na "PlnÃ¡ Diagnostika" pro kompletnÃ­ kontrolu systÃ©mu.
            </div>
        </div>
    </div>
    
    <script>
        // Helper pro vÃ½pis do konzole
        function log(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString('cs-CZ');
            const prefix = {
                'info': 'â„¹ï¸',
                'success': 'âœ…',
                'warning': 'âš ï¸',
                'error': 'âŒ'
            }[type] || 'â„¹ï¸';
            
            output.textContent += `\n[${timestamp}] ${prefix} ${message}`;
            output.scrollTop = output.scrollHeight;
            console.log(`[Diagnostika] ${message}`);
        }
        
        function clearConsole() {
            document.getElementById('console-output').textContent = '';
            log('Konzole vyÄiÅ¡tÄ›na', 'info');
        }
        
        // NaÄtenÃ­ zÃ¡kladnÃ­ch informacÃ­ pÅ™i startu
        window.addEventListener('DOMContentLoaded', async () => {
            log('DiagnostickÃ½ panel naÄten', 'success');
            
            // Browser info
            const browserInfo = navigator.userAgent.includes('Chrome') ? 'Chrome/Edge' : 
                               navigator.userAgent.includes('Firefox') ? 'Firefox' : 
                               navigator.userAgent.includes('Safari') ? 'Safari' : 'NeznÃ¡mÃ½';
            document.getElementById('browser-info').textContent = browserInfo;
            
            // PWA status
            const isPWA = window.matchMedia('(display-mode: standalone)').matches;
            const pwaStatus = document.getElementById('pwa-status');
            pwaStatus.textContent = isPWA ? 'NainstalovÃ¡no âœ…' : 'NenainstalovÃ¡no âš ï¸';
            pwaStatus.className = `status-value ${isPWA ? 'success' : 'warning'}`;
            
            // Notification permission
            const notifPerm = document.getElementById('notification-permission');
            const permission = Notification.permission;
            notifPerm.textContent = permission === 'granted' ? 'Povoleno âœ…' : 
                                   permission === 'denied' ? 'ZamÃ­tnuto âŒ' : 'Nenastaveno âš ï¸';
            notifPerm.className = `status-value ${permission === 'granted' ? 'success' : 'warning'}`;
            
            // Service Worker
            if ('serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.getRegistration();
                const swStatus = document.getElementById('sw-status');
                if (registration && registration.active) {
                    swStatus.textContent = 'AktivnÃ­ âœ…';
                    swStatus.className = 'status-value success';
                } else {
                    swStatus.textContent = 'NeaktivnÃ­ âŒ';
                    swStatus.className = 'status-value error';
                }
            }
            
            // Periodic Sync
            const periodicSupport = 'periodicSync' in ServiceWorkerRegistration.prototype;
            const syncSupport = document.getElementById('periodic-sync-support');
            syncSupport.textContent = periodicSupport ? 'PodporovÃ¡no âœ…' : 'NepodporovÃ¡no âŒ';
            syncSupport.className = `status-value ${periodicSupport ? 'success' : 'error'}`;
            
            if (periodicSupport) {
                try {
                    const registration = await navigator.serviceWorker.ready;
                    const tags = await registration.periodicSync.getTags();
                    const isRegistered = tags.includes('medicine-check-sync');
                    
                    const syncReg = document.getElementById('periodic-sync-registered');
                    syncReg.textContent = isRegistered ? 'AktivnÃ­ âœ…' : 'NeaktivnÃ­ âš ï¸';
                    syncReg.className = `status-value ${isRegistered ? 'success' : 'warning'}`;
                    
                    document.getElementById('active-syncs').textContent = tags.length > 0 ? tags.join(', ') : 'Å½Ã¡dnÃ©';
                } catch (error) {
                    log(`Chyba pÅ™i kontrole Periodic Sync: ${error.message}`, 'error');
                }
            }
            
            // Firebase
            const firebaseStatus = document.getElementById('firebase-status');
            if (typeof firebase !== 'undefined') {
                firebaseStatus.textContent = 'NaÄten âœ…';
                firebaseStatus.className = 'status-value success';
            } else {
                firebaseStatus.textContent = 'NenaÄten âŒ';
                firebaseStatus.className = 'status-value error';
            }
        });
        
        // PlnÃ¡ diagnostika
        async function runFullDiagnostics() {
            clearConsole();
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('SPOUÅ TÃM PLNOU DIAGNOSTIKU', 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            
            // 1. Browser
            log('1. Kontrola prohlÃ­Å¾eÄe...', 'info');
            const isChrome = navigator.userAgent.includes('Chrome');
            const isEdge = navigator.userAgent.includes('Edg');
            if (isChrome || isEdge) {
                log('  âœ… PouÅ¾Ã­vÃ¡Å¡ Chrome/Edge - perfektnÃ­ pro Periodic Sync!', 'success');
            } else {
                log('  âš ï¸ NedoporuÄenÃ½ prohlÃ­Å¾eÄ! PouÅ¾ij Chrome nebo Edge.', 'warning');
            }
            
            // 2. PWA
            log('2. Kontrola PWA instalace...', 'info');
            const isPWA = window.matchMedia('(display-mode: standalone)').matches;
            if (isPWA) {
                log('  âœ… PWA je nainstalovÃ¡na!', 'success');
            } else {
                log('  âš ï¸ PWA nenÃ­ nainstalovÃ¡na! Klikni na ikonu âŠ• v adresnÃ­m Å™Ã¡dku.', 'warning');
            }
            
            // 3. Notifikace
            log('3. Kontrola notifikacÃ­...', 'info');
            if (Notification.permission === 'granted') {
                log('  âœ… Notifikace povoleny!', 'success');
            } else {
                log('  âŒ Notifikace nejsou povoleny! Povol je nejdÅ™Ã­v.', 'error');
            }
            
            // 4. Service Worker
            log('4. Kontrola Service Workeru...', 'info');
            if ('serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.getRegistration();
                if (registration && registration.active) {
                    log(`  âœ… Service Worker aktivnÃ­: ${registration.active.scriptURL}`, 'success');
                } else {
                    log('  âŒ Service Worker nenÃ­ aktivnÃ­!', 'error');
                }
            } else {
                log('  âŒ Service Worker nepodporovÃ¡n!', 'error');
            }
            
            // 5. Periodic Sync
            log('5. Kontrola Periodic Background Sync...', 'info');
            const periodicSupport = 'periodicSync' in ServiceWorkerRegistration.prototype;
            if (periodicSupport) {
                log('  âœ… Periodic Sync je podporovÃ¡n!', 'success');
                
                try {
                    const registration = await navigator.serviceWorker.ready;
                    const tags = await registration.periodicSync.getTags();
                    
                    if (tags.includes('medicine-check-sync')) {
                        log('  âœ… Periodic Sync je AKTIVNÃ!', 'success');
                        log(`  ğŸ“‹ AktivnÃ­ syncs: ${tags.join(', ')}`, 'info');
                    } else {
                        log('  âš ï¸ Periodic Sync NENÃ zaregistrovÃ¡n!', 'warning');
                        log('  ğŸ’¡ Klikni na "Aktivovat Periodic Sync"', 'info');
                    }
                } catch (error) {
                    log(`  âŒ Chyba pÅ™i kontrole: ${error.message}`, 'error');
                }
            } else {
                log('  âŒ Periodic Sync NENÃ podporovÃ¡n!', 'error');
                log('  ğŸ’¡ PÅ™epni na Chrome nebo Edge', 'warning');
            }
            
            // 6. Firebase
            log('6. Kontrola Firebase...', 'info');
            if (typeof firebase !== 'undefined') {
                log('  âœ… Firebase SDK naÄten!', 'success');
            } else {
                log('  âŒ Firebase SDK nenaÄten!', 'error');
            }
            
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('DIAGNOSTIKA DOKONÄŒENA', 'success');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            
            // CelkovÃ© doporuÄenÃ­
            if (isPWA && periodicSupport && Notification.permission === 'granted') {
                log('ğŸ‰ VÃSLEDEK: SystÃ©m je pÅ™ipraven! Aktivuj Periodic Sync.', 'success');
            } else {
                log('âš ï¸ VÃSLEDEK: NÄ›kterÃ© poÅ¾adavky nejsou splnÄ›ny.', 'warning');
            }
        }
        
        // Test notifikace
        async function testNotification() {
            log('PosÃ­lÃ¡m testovacÃ­ notifikaci...', 'info');
            
            if (Notification.permission !== 'granted') {
                log('âŒ Notifikace nejsou povoleny!', 'error');
                return;
            }
            
            try {
                const registration = await navigator.serviceWorker.ready;
                await registration.showNotification('ğŸ§ª Test Notifikace', {
                    body: 'Pokud vidÃ­Å¡ tuto notifikaci, systÃ©m funguje!',
                    icon: 'https://raw.githubusercontent.com/jirka22med/Lekarsky-Protokol-Jirika-2.cz/11b61ddd0c3cf63536e88c9ffdc2acb93321f095/image_192x192.png',
                    tag: 'test-notification'
                });
                log('âœ… TestovacÃ­ notifikace odeslÃ¡na!', 'success');
            } catch (error) {
                log(`âŒ Chyba: ${error.message}`, 'error');
            }
        }
        
        // Registrace Periodic Sync
        async function registerSync() {
            log('Registruji Periodic Sync...', 'info');
            
            if (!('periodicSync' in ServiceWorkerRegistration.prototype)) {
                log('âŒ Periodic Sync nenÃ­ podporovÃ¡n!', 'error');
                return;
            }
            
            const isPWA = window.matchMedia('(display-mode: standalone)').matches;
            if (!isPWA) {
                log('âŒ PWA nenÃ­ nainstalovÃ¡na! NejdÅ™Ã­v nainstaluj aplikaci.', 'error');
                return;
            }
            
            try {
                const registration = await navigator.serviceWorker.ready;
                await registration.periodicSync.register('medicine-check-sync', {
                    minInterval: 12 * 60 * 60 * 1000 // 12 hodin
                });
                log('âœ… Periodic Sync zaregistrovÃ¡n!', 'success');
                log('â° Interval: 12 hodin', 'info');
                
                // Aktualizuj status
                setTimeout(() => window.location.reload(), 1000);
            } catch (error) {
                log(`âŒ Chyba: ${error.message}`, 'error');
            }
        }
        
        // Odregistrace Periodic Sync
        async function unregisterSync() {
            log('OdregistrovÃ¡vÃ¡m Periodic Sync...', 'info');
            
            try {
                const registration = await navigator.serviceWorker.ready;
                await registration.periodicSync.unregister('medicine-check-sync');
                log('âœ… Periodic Sync odregistrovÃ¡n!', 'success');
                
                // Aktualizuj status
                setTimeout(() => window.location.reload(), 1000);
            } catch (error) {
                log(`âŒ Chyba: ${error.message}`, 'error');
            }
        }
        
        // Sync lÃ©kÅ¯
        async function syncMedicines() {
            log('Synchronizuji data lÃ©kÅ¯ do Service Workeru...', 'info');
            log('âš ï¸ Tato funkce vyÅ¾aduje bÄ›Å¾Ã­cÃ­ hlavnÃ­ aplikaci!', 'warning');
            log('ğŸ’¡ OtevÅ™i index.html a data se synchronizujÃ­ automaticky.', 'info');
        }
    </script>
</body>
</html>
